
require 'stringio'

CACHE_FILE = "jquery.syntax.cache.js"

task :update_aliases do
	code = StringIO.new
	
	code.puts "// This file is automatically generated. Any changes may be lost."
	code.puts "// The following declarations describes all resources that might be loaded dynamically."
	code.puts
	
	code.puts "// Brush Aliases"
	Dir["jquery.syntax.brush.*.js"].each do |path|
		File.open(path, "r") do |f|
			first_line = f.readline
			
			if first_line.match(/^\/\/ brush: (.+?) aliases: (.+)$/)
				code.puts "Syntax.alias(#{$1}, #{$2});"
			end
		end
	end
	
	code.puts
	code.puts "// CSS Extensions"
	Dir["jquery.syntax.*.css"].each do |path|
		basename = File.basename(path, ".css")
		code.puts "Syntax.styles[#{basename.dump}] = #{path.dump};"
	end
	
	File.open(CACHE_FILE, "w") do |f|
		f.write(code.string)
	end
	
	puts "Written updated cache file #{CACHE_FILE}:"
	puts code.string
end

task :default => :update_aliases